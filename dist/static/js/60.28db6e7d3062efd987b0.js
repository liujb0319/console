webpackJsonp([60],{"0IYD":function(t,a,e){a=t.exports=e("YfG4")(!1),a.push([t.i,".el-icon-check[data-v-4f9c7d52]{font-size:10px;color:#228b22}.el-icon-close[data-v-4f9c7d52]{font-size:10px;color:#ea0000}.el-icon-warning[data-v-4f9c7d52]{font-size:15px;color:#ff9224}",""])},"6h04":function(t,a,e){"use strict";function s(t){e("MFTv"),e("CNBl")}Object.defineProperty(a,"__esModule",{value:!0});var i=e("OZV4"),o=e("ODod"),n=e("J0+h"),l=s,c=n(i.a,o.a,l,"data-v-4f9c7d52",null);a.default=c.exports},CNBl:function(t,a,e){var s=e("EpXJ");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);e("XkoO")("0e5ef293",s,!0)},EpXJ:function(t,a,e){a=t.exports=e("YfG4")(!1),a.push([t.i,"",""])},MFTv:function(t,a,e){var s=e("0IYD");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);e("XkoO")("96f8ef5c",s,!0)},ODod:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"app-container"},[t.$route.path!=t.localpath?e("div",[e("el-row",{attrs:{align:"middle"}},[e("el-col",{staticClass:"input-btn",attrs:{span:12}},[e("el-input",{attrs:{placeholder:"按名称搜索"},model:{value:t.sbuildConfigName,callback:function(a){t.sbuildConfigName=a},expression:"sbuildConfigName"}}),t._v(" "),e("el-button",{staticClass:"shade-button ml10",on:{click:t.handleClick}},[t._v("搜索")])],1),t._v(" "),e("el-col",{staticClass:"inner-element tr",attrs:{span:12}},[e("el-button",{attrs:{type:"primary"},on:{click:t.creatbuidsClick}},[t._v("创建构建项目")]),t._v(" "),e("div",{staticClass:"ml10 icon-button",on:{click:t.refreshClick}},[e("icon-svg",{attrs:{"icon-class":t.Icons.refreshIcon}})],1)],1)],1),t._v(" "),t.loaded?e("div",{staticClass:"content-container"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData},on:{"cell-click":t.buildsDetailClick}},[e("el-table-column",{attrs:{prop:"name",label:"构建名称",align:"left","class-name":"blue-color"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"ml10 "},[t._v("\n                          "+t._s(a.row.name)+"\n                      ")]),t._v(" "),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"此构建配置已经不存在。",placement:"top-start"}},[a.row.noConfig?e("i",{staticClass:"el-icon-warning icon-small"}):t._e()])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"latestBuild",label:"最新构建",align:"left","class-name":"blue-color"}}),t._v(" "),e("el-table-column",{attrs:{prop:"status",label:"状态",align:"left",width:"200"},scopedSlots:t._u([{key:"default",fn:function(a){return["Complete"===a.row.statusCd?e("i",{staticClass:"el-icon-check icon-small"}):"Failed"===a.row.statusCd?e("i",{staticClass:"el-icon-close icon-small"}):"Error"===a.row.statusCd?e("i",{staticClass:"el-icon-close icon-small"}):a.row.statusCd?e("i",{staticClass:"el-icon-loading icon-small"}):e("i"),t._v(" "),e("span",{staticClass:"ml10 ",class:{"success-staus":"Complete"==a.row.statusCd,"fail-staus":"Failed"==a.row.statusCd,"fail-staus":"Error"==a.row.statusCd,"active-staus":"Running"==a.row.statusCd,"waitfor-status":"New"==a.row.statusCd,"waitfor-status":"Pending"==a.row.statusCd}},[t._v("\n                            "+t._s(a.row.status)+"\n                        ")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"completionTimestamp",label:"时长",align:"left"}}),t._v(" "),e("el-table-column",{attrs:{prop:"creationTimestamp",label:"项目创建时间",align:"left"}}),t._v(" "),e("el-table-column",{attrs:{label:"代码仓库",width:"420",align:"left","class-name":"blue-color"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("a",{attrs:{href:a.row.uri,target:"_blank"}},[t._v(t._s(a.row.uri))])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"ref",label:"代码分支",align:"left",width:"100"}})],1)],1):e("div",[t._m(0)])],1):t._e(),t._v(" "),e("router-view")],1)},i=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticStyle:{"text-align":"center","line-height":"250px"}},[e("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"20px"}}),e("span",[t._v(" 加载中······")])])}],o={render:s,staticRenderFns:i};a.a=o},OZV4:function(t,a,e){"use strict";var s=e("4YfN"),i=e.n(s),o=e("lQSI"),n=e("hsap"),l=e.n(n);a.a={props:{},beforeMount:function(){this.load()},created:function(){},ready:function(){},data:function(){return{sbuildConfigName:"",tableData:[],builds:[],buildconfigs:[],loaded:!1,reload:!1,refreshIcon:null}},components:{},filters:{},methods:{load:function(){this.reload=!1;var t=this;this.$ajax.get(this.$httpConfig.builds.replace("{projectName}",t.$route.params.disName)).then(function(a){t.builds=a.data.items,t.updateByServer(a.data.metadata.selfLink,t.$token,a.data.metadata.resourceVersion),t.$ajax.get(t.$httpConfig.buildconfigs.replace("{projectName}",t.$route.params.disName)).then(function(a){t.buildconfigs=a.data.items,t.setValueToPage(),t.loaded=!0,t.updateByServer(a.data.metadata.selfLink,t.$token,a.data.metadata.resourceVersion)}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},setValueToPage:function(){var t=[];t=this.builds;var a=[];for(var e in t)"JenkinsPipeline"!==t[e].spec.strategy.type&&a.push(t[e]);var s=[];s=this.buildconfigs;var i=[];for(var o in s)"JenkinsPipeline"!==s[o].spec.strategy.type&&i.push(s[o]);var n={};a.forEach(function(t){var a=t.metadata.labels.buildconfig||t.metadata.annotations["openshift.io/build-config.name"]||"";n[a]?l()(n[a].metadata.creationTimestamp).isBefore(t.metadata.creationTimestamp)&&(n[a]=t):n[a]=t}),i.forEach(function(t){var a=t.metadata.name;n[a]=n[a]||null});var c={},r={},s={};for(var u in i)s[i[u].metadata.name]=i[u];for(var d in n)n[d]||(c[d]=s[d]),s[d]||(r[d]=n[d]);if(this.sbuildConfigName){var f={};for(var m in n)m===this.sbuildConfigName&&(f[m]=n[m]);n=f;var b={};for(var p in c)p===this.sbuildConfigName&&(b[p]=c[m]);c=b;var h={};for(var g in r)g===this.sbuildConfigName&&(h[g]=r[m]);r=h}this.tableData=[];for(var m in n){var v=n[m];v&&!r[m]&&this.tableData.push({name:m,latestBuild:v.metadata.annotations["openshift.io/build.number"]?"#"+v.metadata.annotations["openshift.io/build.number"]:v.metadata.name,latestBuildNme:v.metadata.name,statusCd:v.status.phase,status:this.getStatus(v),creationTimestamp:this.timeago.format(v.metadata.creationTimestamp,"zh_CN"),completionTimestamp:this.getDuration(v),uri:v.spec.source.git.uri,ref:v.spec.source.git.ref})}for(var g in r){var C=r[g];C&&this.tableData.push({name:C.metadata.labels.buildconfig||C.metadata.annotations["openshift.io/build-config.name"]||"",noConfig:!0,latestBuild:C.metadata.annotations["openshift.io/build.number"]?"#"+C.metadata.annotations["openshift.io/build.number"]:C.metadata.name,latestBuildNme:C.metadata.name,statusCd:C.status.phase,status:this.getStatus(C),creationTimestamp:this.timeago.format(C.metadata.creationTimestamp,"zh_CN"),completionTimestamp:this.getDuration(C),uri:C.spec.source.git.uri,ref:C.spec.source.git.ref})}for(var k in c){var _=c[k];_&&this.tableData.push({name:_.metadata.name,latestBuild:"没有构建",statusCd:"",status:"",creationTimestamp:" ",completionTimestamp:" ",uri:_.spec.source.git.uri,ref:_.spec.source.git.ref})}},updateByServer:function(t,a,e){var s=this,i=this.$httpConfig.socketHost+t+"?access_token="+a+"&watch=true&resourceVersion="+e,o=new WebSocket(i);o.onmessage=function(t){console.log("[builds-onmessage]");var a=JSON.parse(t.data);if(a.type&&"DELETED"===a.type){if("Build"===a.object.kind){for(var e in s.builds)if(s.builds[e].metadata.name===a.object.metadata.name){s.builds.splice(e,1);break}}else if("BuildConfig"===a.object.kind)for(var e in s.buildconfigs)if(s.buildconfigs[e].metadata.name===a.object.metadata.name){s.buildconfigs.splice(e,1);break}}else if(a.type&&"MODIFIED"===a.type){if("Build"===a.object.kind){for(var e in s.builds)if(s.builds[e].metadata.name===a.object.metadata.name){s.builds[e].metadata=a.object.metadata,s.builds[e].spec=a.object.spec,s.builds[e].status=a.object.status;break}}else if("BuildConfig"===a.object.kind)for(var e in s.buildconfigs)if(s.buildconfigs[e].metadata.name===a.object.metadata.name){s.buildconfigs[e].metadata=a.object.metadata,s.buildconfigs[e].spec=a.object.spec,s.buildconfigs[e].status=a.object.status;break}}else if(a.type&&"ADDED"===a.type)if("Build"===a.object.kind){var i=!1;for(var e in s.builds)if(s.builds[e].metadata.name===a.object.metadata.name){s.builds[e].metadata=a.object.metadata,s.builds[e].spec=a.object.spec,s.builds[e].status=a.object.status,i=!0;break}i||s.builds.push(a.object)}else if("BuildConfig"===a.object.kind){var i=!1;for(var e in s.buildconfigs)if(s.buildconfigs[e].metadata.name===a.object.metadata.name){s.buildconfigs[e].metadata=a.object.metadata,s.buildconfigs[e].spec=a.object.spec,s.buildconfigs[e].status=a.object.status,i=!0;break}i||s.buildconfigs.push(a.object)}},o.onerror=function(t){console.log("[onerror]"),console.log(t)},o.onopen=function(t){console.log("[onopen]"),console.log(t)},o.onclose=function(){console.log("[onclose]")}},clear:function(){this.refreshIcon=null,this.tableData=[]},getStatus:function(t){var a="";switch(t.status.phase){case"Complete":a="• 构建成功";break;case"Running":a="• 正在构建";break;case"Pending":a="• 构建等待中";break;case"Failed":a="• 构建失败";break;case"New":a="• 新建构建";break;case"Error":a="• 构建错误"}return a},getDuration:function(t){var a=t.status.startTimestamp,e=t.status.creationTimestamp,s=t.status.completionTimestamp,i=0;switch(t.status.phase){case"Complete":case"Failed":case"Error":i=(l()(s).diff(l()(a))/1e3).toFixed()+"秒";break;case"Running":i=(l()().diff(l()(a))/1e3).toFixed()+"秒";break;case"New":case"Pending":i=(l()().diff(l()(e))/1e3).toFixed()+"秒";break;default:i=(l()().diff(l()(e))/1e3).toFixed()+"秒"}return i},handleClick:function(){this.clear(),this.load()},refreshClick:function(){this.clear(),this.load()},buildsDetailClick:function(t,a,e,s){"构建名称"===a.label&&"没有构建配置"!==t.name?this.$router.push({name:"构建项目详情",query:{buildconfigName:t.name}}):"最新构建"===a.label&&"没有构建"!==t.latestBuild&&this.$router.push({name:"构建构建历史",query:{buildName:t.latestBuildNme}})},creatbuidsClick:function(){this.$router.push({name:"选择应用框架"})}},computed:i()({},e.i(o.b)(["localpath","Icons"])),watch:{reload:function(t){t&&this.load()},builds:{handler:function(t){console.log("builds change"),this.setValueToPage()},deep:!0},buildconfigs:{handler:function(t){console.log("buildconfigs change"),this.setValueToPage()},deep:!0}}}}});