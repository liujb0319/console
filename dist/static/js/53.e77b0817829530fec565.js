webpackJsonp([53],{"3cXf":function(e,t,a){e.exports={default:a("I4CF"),__esModule:!0}},CF9B:function(e,t,a){var i=a("jW4B");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("XkoO")("d775ceb4",i,!0)},I4CF:function(e,t,a){var i=a("0nnt"),s=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}},JoWg:function(e,t,a){"use strict";var i=a("4YfN"),s=a.n(i),n=a("3cXf"),o=a.n(n),r=a("lQSI"),l=(a("Q0Ca"),a("hsap")),c=a.n(l);t.a={props:{},created:function(){},ready:function(){this.template=JSON.parse(o()(this.template))},data:function(){return{tableKey:0,listLoading:!1,template:{},list:10,total:100,loaded:!1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"},imagestreams:[],imageName:"",tableData:[]}},beforeMount:function(){this.load()},components:{},filters:{},methods:{load:function(){var e=this;this.$ajax.get(this.$httpConfig.images.replace("{projectName}",e.$route.params.disName)).then(function(t){e.loaded=!0,e.imagestreams=t.data.items,e.setValueToPage(),e.updateByServer(t.data.metadata.selfLink,e.$token,t.data.metadata.resourceVersion)}).catch(function(e){console.log(e)})},setValueToPage:function(){this.tableData=[];for(var e=0;e<this.imagestreams.length;e++){var t=this.imagestreams[e];!t.metadata||this.imageName&&t.metadata.name!==this.imageName||this.tableData.push({name:t.metadata.name,tag:this.getTags(t.status.tags),dockerImageRepository:"https://"+t.status.dockerImageRepository,creationTimestamp:this.timeago.format(t.metadata.creationTimestamp,"zh_CN"),sortData:t.metadata.creationTimestamp})}this.tableData=this.tableData.sort(this.compare)},compare:function(e,t){return c()(t.sortData).unix()-c()(e.sortData).unix()},getTags:function(e){var t="";if(e&&e.length<6)for(var a in e)t+=e[a].tag,a<e.length-1&&(t+=",");else if(e&&e.length>5)for(var a in e){if(!(a<4)){t=t+(e.length-4)+"个其他";break}t=t+e[a].tag+","}else t="none";return t},updateByServer:function(e,t,a){var i=this,s=this.$httpConfig.socketHost+e+"?access_token="+t+"&watch=true&resourceVersion="+a;console.log(s);var n=new WebSocket(s);n.onmessage=function(e){var t=JSON.parse(e.data);if(t.type&&"MODIFIED"===t.type){if("ImageStream"===t.object.kind)for(var a in i.imagestreams)if(i.imagestreams[a].metadata.name===t.object.metadata.name){i.imagestreams[a].metadata=t.object.metadata,i.imagestreams[a].spec=t.object.spec,i.imagestreams[a].status=t.object.status;break}}else if(t.type&&"ADDED"===t.type&&"ImageStream"===t.object.kind){var s=!1;for(var a in i.imagestreams)if(i.imagestreams[a].metadata.name===t.object.metadata.name){i.imagestreams[a].metadata=t.object.metadata,i.imagestreams[a].spec=t.object.spec,i.imagestreams[a].status=t.object.status,s=!0;break}s||i.imagestreams.push(t.object)}},n.onerror=function(e){console.log("[onerror]"),console.log(e)},n.onopen=function(e){console.log("[onopen]"),console.log(e)},n.onclose=function(){console.log("[onclose]")}},filterClick:function(){this.load()},handleClick:function(e,t,a,i){"镜像名称"===t.label&&this.$router.push({name:"镜像详情",query:{imageName:e.name}})},handleSizeChange:function(e){this.listQuery.limit=e,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()}},computed:s()({},a.i(r.b)(["localpath"])),watch:{imagestreams:{handler:function(e){console.log("imagestreams change"),this.imagestreams&&this.imagestreams.length&&this.setValueToPage()},deep:!0}}}},Mt9R:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.loaded?a("div",{staticClass:"app-container"},[e.$route.path!=e.localpath?a("div",[a("el-row",{staticClass:"fr",attrs:{gutter:20}},[a("el-col",{},[a("div",{staticClass:"input-btn"},[a("el-input",{attrs:{placeholder:"按镜像名称过滤"},model:{value:e.imageName,callback:function(t){e.imageName=t},expression:"imageName"}}),e._v(" "),a("el-button",{staticClass:"ml10",on:{click:e.filterClick}},[e._v("过滤")])],1)])],1),e._v(" "),a("div",{staticClass:"clearfix"}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,stripe:"","highlight-current-row":""},on:{"cell-click":e.handleClick}},[a("el-table-column",{attrs:{prop:"name",label:"镜像名称",width:"180","header-align":"center",align:"center","class-name":"blue-color"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tag",label:"Tag",width:"250","header-align":"center",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dockerImageRepository",label:"镜像仓库信息","header-align":"center",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"creationTimestamp",label:"创建时间","header-align":"center",align:"center"}})],1)],1):e._e(),e._v(" "),a("router-view")],1):a("div",[e._m(0)])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"text-align":"center","line-height":"250px"}},[a("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"20px"}}),a("span",[e._v(" 加载中······")])])}],n={render:i,staticRenderFns:s};t.a=n},jW4B:function(e,t,a){t=e.exports=a("YfG4")(!1),t.push([e.i,"",""])},uIuo:function(e,t,a){"use strict";function i(e){a("CF9B")}Object.defineProperty(t,"__esModule",{value:!0});var s=a("JoWg"),n=a("Mt9R"),o=a("J0+h"),r=i,l=o(s.a,n.a,r,"data-v-1038cd96",null);t.default=l.exports}});